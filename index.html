<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‰∫∫‰ΩìÁóõ„Åø„Éû„ÉÉ„Éó</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 30px;
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            font-size: 2.5em;
        }

        .view-tabs {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 30px;
        }

        .tab-button {
            padding: 12px 30px;
            background: #f0f0f0;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
        }

        .tab-button.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            transform: translateY(-2px);
        }

        .main-content {
            display: flex;
            gap: 30px;
            align-items: flex-start;
        }

        .body-view {
            flex: 1;
            background: #f9f9f9;
            border-radius: 15px;
            padding: 20px;
            min-height: 600px;
            position: relative;
        }

        .body-canvas {
            width: 100%;
            height: 600px;
            border-radius: 10px;
            background: white;
            cursor: crosshair;
        }

        .controls {
            width: 350px;
            background: #f9f9f9;
            border-radius: 15px;
            padding: 20px;
        }

        .control-group {
            margin-bottom: 25px;
        }

        .control-group label {
            display: block;
            margin-bottom: 10px;
            color: #555;
            font-weight: 600;
        }

        .pain-slider {
            width: 100%;
            height: 40px;
            -webkit-appearance: none;
            appearance: none;
            background: linear-gradient(90deg, #ffcccc 0%, #ff6666 50%, #cc0000 100%);
            border-radius: 20px;
            outline: none;
            opacity: 0.9;
            transition: opacity 0.2s;
        }

        .pain-slider:hover {
            opacity: 1;
        }

        .pain-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 25px;
            height: 25px;
            background: white;
            border: 3px solid #333;
            border-radius: 50%;
            cursor: pointer;
        }

        .pain-value {
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            margin-top: 10px;
            color: #333;
        }

        .body-part-select {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            background: white;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 30px;
        }

        .btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-secondary {
            background: #e0e0e0;
            color: #333;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .legend {
            display: flex;
            justify-content: space-around;
            margin-top: 20px;
            padding: 15px;
            background: white;
            border-radius: 10px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .legend-color {
            width: 30px;
            height: 30px;
            border-radius: 5px;
            border: 1px solid #ddd;
        }

        .body-svg {
            width: 100%;
            height: 100%;
        }

        .body-part {
            fill: #f0f0f0;
            stroke: #333;
            stroke-width: 2;
            cursor: pointer;
            transition: all 0.3s;
        }

        .head-cell {
            fill: #f0f0f0;
            stroke: #aaa;
            stroke-width: 0.5;
            cursor: pointer;
            transition: all 0.3s;
        }

        .head-cell:hover {
            stroke: #667eea;
            stroke-width: 1.5;
            filter: brightness(0.95);
        }

        .head-cell.selected {
            stroke: #667eea;
            stroke-width: 2;
        }

        .body-part:hover {
            stroke-width: 3;
            filter: brightness(0.95);
        }

        .body-part.selected {
            stroke: #667eea;
            stroke-width: 4;
        }

        #savedMaps {
            margin-top: 20px;
        }

        .saved-map-item {
            padding: 10px;
            background: white;
            border-radius: 8px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .saved-map-item:hover {
            background: #f0f0f0;
            transform: translateX(5px);
        }

        .date-time {
            font-size: 12px;
            color: #888;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üè• ‰∫∫‰ΩìÁóõ„Åø„Éû„ÉÉ„Éó</h1>
        
        <div class="view-tabs">
            <button class="tab-button active" data-view="front">ÂâçÈù¢</button>
            <button class="tab-button" data-view="back">ËÉåÈù¢</button>
            <button class="tab-button" data-view="left">Â∑¶ÂÅ¥Èù¢</button>
            <button class="tab-button" data-view="right">Âè≥ÂÅ¥Èù¢</button>
        </div>

        <div class="main-content">
            <div class="body-view">
                <svg class="body-svg" viewBox="0 0 400 600" id="bodySvg">
                    <!-- Front View -->
                    <g id="front-view">
                        <!-- Head with 10x10 grid -->
                        <g id="head-grid-front">
                            <!-- Head outline -->
                            <ellipse fill="none" stroke="#999" stroke-width="1" cx="200" cy="80" rx="50" ry="60"/>
                            <!-- Grid cells will be added by JavaScript -->
                        </g>
                        <!-- Neck -->
                        <rect class="body-part" data-part="neck" x="180" y="130" width="40" height="30"/>
                        <!-- Shoulders -->
                        <rect class="body-part" data-part="left-shoulder" x="120" y="160" width="60" height="40"/>
                        <rect class="body-part" data-part="right-shoulder" x="220" y="160" width="60" height="40"/>
                        <!-- Arms -->
                        <rect class="body-part" data-part="left-upper-arm" x="90" y="200" width="40" height="80"/>
                        <rect class="body-part" data-part="right-upper-arm" x="270" y="200" width="40" height="80"/>
                        <rect class="body-part" data-part="left-lower-arm" x="85" y="280" width="35" height="80"/>
                        <rect class="body-part" data-part="right-lower-arm" x="280" y="280" width="35" height="80"/>
                        <!-- Chest -->
                        <rect class="body-part" data-part="chest" x="150" y="160" width="100" height="100"/>
                        <!-- Abdomen -->
                        <rect class="body-part" data-part="abdomen" x="150" y="260" width="100" height="80"/>
                        <!-- Pelvis -->
                        <rect class="body-part" data-part="pelvis" x="150" y="340" width="100" height="40"/>
                        <!-- Legs -->
                        <rect class="body-part" data-part="left-thigh" x="150" y="380" width="45" height="100"/>
                        <rect class="body-part" data-part="right-thigh" x="205" y="380" width="45" height="100"/>
                        <rect class="body-part" data-part="left-shin" x="152" y="480" width="40" height="100"/>
                        <rect class="body-part" data-part="right-shin" x="208" y="480" width="40" height="100"/>
                    </g>

                    <!-- Back View (hidden by default) -->
                    <g id="back-view" style="display: none;">
                        <!-- Head with 10x10 grid -->
                        <g id="head-grid-back">
                            <ellipse fill="#f0f0f0" stroke="#999" stroke-width="1" cx="200" cy="80" rx="50" ry="60"/>
                            <!-- Create 10x10 grid for head -->
                        </g>
                        
                        <!-- Rest of back body -->
                        <rect class="body-part" data-part="neck-back" x="180" y="130" width="40" height="30"/>
                        <rect class="body-part" data-part="left-shoulder-back" x="120" y="160" width="60" height="40"/>
                        <rect class="body-part" data-part="right-shoulder-back" x="220" y="160" width="60" height="40"/>
                        <rect class="body-part" data-part="upper-back" x="150" y="160" width="100" height="100"/>
                        <rect class="body-part" data-part="lower-back" x="150" y="260" width="100" height="80"/>
                        <rect class="body-part" data-part="buttocks" x="150" y="340" width="100" height="40"/>
                        <rect class="body-part" data-part="left-thigh-back" x="150" y="380" width="45" height="100"/>
                        <rect class="body-part" data-part="right-thigh-back" x="205" y="380" width="45" height="100"/>
                        <rect class="body-part" data-part="left-calf-back" x="152" y="480" width="40" height="100"/>
                        <rect class="body-part" data-part="right-calf-back" x="208" y="480" width="40" height="100"/>
                    </g>

                    <!-- Left Side View -->
                    <g id="left-view" style="display: none;">
                        <ellipse class="body-part" data-part="head-left" cx="200" cy="80" rx="40" ry="60"/>
                        <rect class="body-part" data-part="neck-left" x="185" y="130" width="30" height="30"/>
                        <rect class="body-part" data-part="shoulder-left" x="170" y="160" width="45" height="40"/>
                        <rect class="body-part" data-part="arm-left" x="130" y="200" width="35" height="160"/>
                        <rect class="body-part" data-part="torso-left" x="170" y="160" width="60" height="180"/>
                        <rect class="body-part" data-part="hip-left" x="170" y="340" width="60" height="40"/>
                        <rect class="body-part" data-part="thigh-left" x="175" y="380" width="50" height="100"/>
                        <rect class="body-part" data-part="shin-left" x="177" y="480" width="45" height="100"/>
                    </g>

                    <!-- Right Side View -->
                    <g id="right-view" style="display: none;">
                        <ellipse class="body-part" data-part="head-right" cx="200" cy="80" rx="40" ry="60"/>
                        <rect class="body-part" data-part="neck-right" x="185" y="130" width="30" height="30"/>
                        <rect class="body-part" data-part="shoulder-right" x="185" y="160" width="45" height="40"/>
                        <rect class="body-part" data-part="arm-right" x="235" y="200" width="35" height="160"/>
                        <rect class="body-part" data-part="torso-right" x="170" y="160" width="60" height="180"/>
                        <rect class="body-part" data-part="hip-right" x="170" y="340" width="60" height="40"/>
                        <rect class="body-part" data-part="thigh-right" x="175" y="380" width="50" height="100"/>
                        <rect class="body-part" data-part="shin-right" x="177" y="480" width="45" height="100"/>
                    </g>
                </svg>
            </div>

            <div class="controls">
                <div class="control-group">
                    <label for="bodyPartSelect">ÈÉ®‰Ωç„ÇíÈÅ∏Êäû:</label>
                    <select id="bodyPartSelect" class="body-part-select">
                        <option value="">„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶ÈÉ®‰Ωç„ÇíÈÅ∏Êäû</option>
                        <option value="head">È†≠ÈÉ®</option>
                        <option value="neck">È¶ñ</option>
                        <option value="left-shoulder">Â∑¶ËÇ©</option>
                        <option value="right-shoulder">Âè≥ËÇ©</option>
                        <option value="chest">ËÉ∏ÈÉ®</option>
                        <option value="abdomen">ËÖπÈÉ®</option>
                        <option value="lower-back">ËÖ∞</option>
                        <option value="left-upper-arm">Â∑¶‰∏äËÖï</option>
                        <option value="right-upper-arm">Âè≥‰∏äËÖï</option>
                        <option value="left-lower-arm">Â∑¶ÂâçËÖï</option>
                        <option value="right-lower-arm">Âè≥ÂâçËÖï</option>
                        <option value="left-thigh">Â∑¶Â§™„ÇÇ„ÇÇ</option>
                        <option value="right-thigh">Âè≥Â§™„ÇÇ„ÇÇ</option>
                        <option value="left-shin">Â∑¶„Åô„Å≠</option>
                        <option value="right-shin">Âè≥„Åô„Å≠</option>
                    </select>
                </div>

                <div class="control-group">
                    <label for="painSlider">Áóõ„Åø„É¨„Éô„É´ (0-10):</label>
                    <input type="range" id="painSlider" class="pain-slider" min="0" max="10" value="0" step="0.1">
                    <div class="pain-value" id="painValue">0</div>
                </div>

                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background: #ffcccc;"></div>
                        <span>Âº±„ÅÑ (0-3)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #ff6666;"></div>
                        <span>‰∏≠Á®ãÂ∫¶ (4-7)</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background: #cc0000;"></div>
                        <span>Âº∑„ÅÑ (8-10)</span>
                    </div>
                </div>

                <div class="action-buttons">
                    <button class="btn btn-primary" id="saveBtn">‰øùÂ≠ò</button>
                    <button class="btn btn-secondary" id="clearBtn">„ÇØ„É™„Ç¢</button>
                </div>

                <div class="control-group">
                    <label>‰øùÂ≠òÊ∏à„Åø„Éû„ÉÉ„Éó:</label>
                    <div id="savedMaps"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Pain map data storage
        let painData = {};
        let currentView = 'front';
        let selectedPart = null;

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadSavedMaps();
            initializeEventListeners();
            createHeadGrid();
        });

        // Create 10x10 grid for head
        function createHeadGrid() {
            const gridContainer = document.getElementById('head-grid-front');
            const cx = 200;
            const cy = 80;
            const rx = 50;
            const ry = 60;
            
            // Create grid cells
            for (let row = 0; row < 10; row++) {
                for (let col = 0; col < 10; col++) {
                    // Calculate position within ellipse
                    const x = cx - rx + (col * (rx * 2) / 10) + rx/10;
                    const y = cy - ry + (row * (ry * 2) / 10) + ry/10;
                    const cellWidth = (rx * 2) / 10;
                    const cellHeight = (ry * 2) / 10;
                    
                    // Check if cell center is within ellipse
                    const cellCenterX = x;
                    const cellCenterY = y;
                    const normalizedX = (cellCenterX - cx) / rx;
                    const normalizedY = (cellCenterY - cy) / ry;
                    
                    if (normalizedX * normalizedX + normalizedY * normalizedY <= 1) {
                        const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                        rect.setAttribute('class', 'head-cell');
                        rect.setAttribute('data-part', `head-${row}-${col}`);
                        rect.setAttribute('x', x - cellWidth/2);
                        rect.setAttribute('y', y - cellHeight/2);
                        rect.setAttribute('width', cellWidth);
                        rect.setAttribute('height', cellHeight);
                        rect.setAttribute('rx', '2');
                        gridContainer.appendChild(rect);
                        
                        // Add event listener
                        rect.addEventListener('click', function() {
                            selectBodyPart(this.dataset.part);
                        });
                    }
                }
            }
        }

        // View tab switching
        document.querySelectorAll('.tab-button').forEach(button => {
            button.addEventListener('click', function() {
                document.querySelectorAll('.tab-button').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                currentView = this.dataset.view;
                switchView(currentView);
            });
        });

        function switchView(view) {
            // Hide all views
            document.getElementById('front-view').style.display = 'none';
            document.getElementById('back-view').style.display = 'none';
            document.getElementById('left-view').style.display = 'none';
            document.getElementById('right-view').style.display = 'none';
            
            // Show selected view
            if (view === 'front') {
                document.getElementById('front-view').style.display = 'block';
            } else if (view === 'back') {
                document.getElementById('back-view').style.display = 'block';
            } else if (view === 'left') {
                document.getElementById('left-view').style.display = 'block';
            } else if (view === 'right') {
                document.getElementById('right-view').style.display = 'block';
            }
        }

        // Body part selection
        document.querySelectorAll('.body-part').forEach(part => {
            part.addEventListener('click', function() {
                selectBodyPart(this.dataset.part);
            });
        });

        function selectBodyPart(partName) {
            // Remove previous selection
            document.querySelectorAll('.body-part, .head-cell').forEach(p => p.classList.remove('selected'));
            
            // Add selection to clicked part
            const part = document.querySelector(`[data-part="${partName}"]`);
            if (part) {
                part.classList.add('selected');
                selectedPart = partName;
                
                // Update dropdown if it's a standard part
                if (!partName.startsWith('head-')) {
                    document.getElementById('bodyPartSelect').value = partName;
                } else {
                    document.getElementById('bodyPartSelect').value = '';
                }
                
                // Load existing pain level for this part
                const existingPain = painData[partName] || 0;
                document.getElementById('painSlider').value = existingPain;
                document.getElementById('painValue').textContent = existingPain.toFixed(1);
                updatePartColor(part, existingPain);
            }
        }

        // Pain slider
        document.getElementById('painSlider').addEventListener('input', function() {
            const value = parseFloat(this.value);
            document.getElementById('painValue').textContent = value.toFixed(1);
            
            if (selectedPart) {
                painData[selectedPart] = value;
                const part = document.querySelector(`[data-part="${selectedPart}"]`);
                updatePartColor(part, value);
            }
        });

        // Body part select dropdown
        document.getElementById('bodyPartSelect').addEventListener('change', function() {
            if (this.value) {
                selectBodyPart(this.value);
            }
        });

        function updatePartColor(element, painLevel) {
            let color;
            if (painLevel === 0) {
                color = '#f0f0f0';
            } else {
                // Ëµ§Ëâ≤„ÅÆÂçò‰∏Ä„Ç∞„É©„Éá„Éº„Ç∑„Éß„É≥ÔºàÈÄèÊòéÂ∫¶„Å®Âº∑Â∫¶„ÅßË™øÊï¥Ôºâ
                const intensity = painLevel / 10;
                const red = Math.floor(255 - (100 * (1 - intensity)));
                const alpha = 0.2 + (intensity * 0.8);
                color = `rgba(${red}, 0, 0, ${alpha})`;
            }
            element.style.fill = color;
        }

        // Save button
        document.getElementById('saveBtn').addEventListener('click', function() {
            const mapData = {
                timestamp: new Date().toISOString(),
                data: {...painData}  // „Éá„Éº„Çø„ÅÆ„Ç≥„Éî„Éº„Çí‰øùÂ≠ò
            };
            
            console.log('Saving data:', mapData);
            
            let savedMaps = JSON.parse(localStorage.getItem('painMaps') || '[]');
            savedMaps.unshift(mapData);
            // Keep only last 10 maps
            savedMaps = savedMaps.slice(0, 10);
            localStorage.setItem('painMaps', JSON.stringify(savedMaps));
            
            // ‰øùÂ≠òÊàêÂäü„ÇíÁ¢∫Ë™ç
            const saved = localStorage.getItem('painMaps');
            console.log('Data saved to localStorage:', saved);
            
            loadSavedMaps();
            alert('Áóõ„Åø„Éû„ÉÉ„Éó„Çí‰øùÂ≠ò„Åó„Åæ„Åó„ÅüÔºÅ\n‰øùÂ≠ò„Éá„Éº„ÇøÊï∞: ' + Object.keys(painData).length + '‰ª∂');
        });

        // Clear button
        document.getElementById('clearBtn').addEventListener('click', function() {
            if (confirm('„Åô„Åπ„Å¶„ÅÆÁóõ„Åø„Éá„Éº„Çø„Çí„ÇØ„É™„Ç¢„Åó„Åæ„Åô„ÅãÔºü')) {
                painData = {};
                document.querySelectorAll('.body-part, .head-cell').forEach(part => {
                    part.style.fill = '#f0f0f0';
                    part.classList.remove('selected');
                });
                document.getElementById('painSlider').value = 0;
                document.getElementById('painValue').textContent = '0';
                document.getElementById('bodyPartSelect').value = '';
                selectedPart = null;
                console.log('Data cleared:', painData);
            }
        });

        function loadSavedMaps() {
            const savedMaps = JSON.parse(localStorage.getItem('painMaps') || '[]');
            const container = document.getElementById('savedMaps');
            container.innerHTML = '';
            
            savedMaps.forEach((map, index) => {
                const date = new Date(map.timestamp);
                const item = document.createElement('div');
                item.className = 'saved-map-item';
                item.innerHTML = `
                    <div>„Éû„ÉÉ„Éó ${index + 1}</div>
                    <div class="date-time">${date.toLocaleDateString('ja-JP')} ${date.toLocaleTimeString('ja-JP')}</div>
                `;
                item.addEventListener('click', () => loadMap(map.data));
                container.appendChild(item);
            });
        }

        function loadMap(data) {
            painData = data;
            document.querySelectorAll('.body-part, .head-cell').forEach(part => {
                const partName = part.dataset.part;
                const painLevel = data[partName] || 0;
                updatePartColor(part, painLevel);
            });
            console.log('Map loaded:', data);
        }

        function initializeEventListeners() {
            // Initialize all parts with default color
            document.querySelectorAll('.body-part, .head-cell').forEach(part => {
                part.style.fill = '#f0f0f0';
            });
        }
    </script>
</body>
</html>